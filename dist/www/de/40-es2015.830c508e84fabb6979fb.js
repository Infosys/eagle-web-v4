/*               "Copyright 2020 Infosys Ltd.
               Use of this source code is governed by GPL v3 license that can be found in the LICENSE file or at https://opensource.org/licenses/GPL-3.0
               This program is free software: you can redistribute it and/or modify it under the terms of the GNU General Public License version 3"*/
(window.webpackJsonp=window.webpackJsonp||[]).push([[40],{Jmk9:function(t,e,n){"use strict";n.d(e,"a",function(){return a});var i=n("z6cu"),o=n("VX4o"),r=n("8Y7J"),s=n("IheW");class a{constructor(t,e){this.http=t,this.telemetrySvc=e,this.API_BASE="/clientApi/v2",this.USER_API=`${this.API_BASE}/user`,this.apiEndpoints={USER_HISTORY:`${this.USER_API}/history`,USER_CONTINUE_LEARNING:`${this.USER_API}/history/continue`}}fetchContinueLearning(t,e,n){return this.http.get(`${this.apiEndpoints.USER_CONTINUE_LEARNING}?pageSize=${t}`+(e?`&pageState=${e}`:"")+(n?`&email=${n}`:""))}saveContinueLearning(t,e){const n=this.apiEndpoints.USER_CONTINUE_LEARNING;return Object.keys(t).length?this.http.post(n,t):(this.telemetrySvc.errorTelemetryEvent(n,t,e),Object(i.a)({message:"EMPTY_REQUEST"}))}fetchContentContinueLearning(t){return this.http.get(`${this.apiEndpoints.USER_CONTINUE_LEARNING}/${t}`)}addHistory(t){return this.http.post(this.apiEndpoints.USER_HISTORY+"/"+t,{})}deleteHistory(t){return this.http.delete(this.apiEndpoints.USER_HISTORY+"/"+t)}}a.ngInjectableDef=r["\u0275\u0275defineInjectable"]({factory:function(){return new a(r["\u0275\u0275inject"](s.c),r["\u0275\u0275inject"](o.a))},token:a,providedIn:"root"})},PnTj:function(t,e,n){"use strict";var i=n("mrSG"),o=n("xgIS"),r=n("pLZG"),s=n("5DKC"),a=n("LRne"),c=n("JIr8"),d=n("8Y7J"),u=n("IheW");class h{constructor(t){this.http=t,this.apiEndpoints={setCookie:`${s.c}/videojs/setCookie`,setS3Cookie:`${s.d}/setS3Cookie/setCookie`}}setVideoCookie(t){return this.http.post(this.apiEndpoints.setCookie,{path:t}).pipe(Object(c.a)(t=>Object(a.a)(!0)))}setS3Cookie(t){return this.http.post(this.apiEndpoints.setS3Cookie,{path:t}).pipe(Object(c.a)(t=>Object(a.a)(!0)))}}h.ngInjectableDef=d["\u0275\u0275defineInjectable"]({factory:function(){return new h(d["\u0275\u0275inject"](u.c))},token:h,providedIn:"root"});var l=n("hFHK"),p=n("NBun"),f=n("oVAt"),m=n("vPp1");n.d(e,"a",function(){return E});const y="DATA_REQUEST",v="DATA_RESPONSE",_=new Set(Object.values(l.a));class C extends Error{constructor(t){super(t),this.code=t}}class E{constructor(t,e,n,i,o){this.http=t,this.contentSvc=e,this.miscSvc=n,this.historySvc=i,this.s3ContentApi=o,this.initGlobalDataRequestResponder()}updateViewCountAndHistoryOnLoad(t,e){this.contentSvc.updateViewCount(e).toPromise(),t&&t!==e&&this.historySvc.saveContinueLearning({contextPathId:t,resourceId:e,percentComplete:0,data:JSON.stringify({timestamp:Date.now()})},e).toPromise().catch(t=>console.warn(t)),this.historySvc.addToHistory(e)}processResponse(t){return i.__awaiter(this,void 0,void 0,function*(){const e={id:t.id,data:null},n=this.resumePoint(t.contentId);try{const o=yield this.fetchContentAndValidate(t.contentId);e.data=yield this.transformContent(o),e.data.resumeData=yield n}catch(i){e.error=i.code||"UNKNOWN_ERROR"}return e})}fetchContentAndValidate(t){return i.__awaiter(this,void 0,void 0,function*(){try{const n=yield this.contentSvc.fetchContent(t).toPromise();if("Resource"!==n.contentType&&"Knowledge Artifact"!==n.contentType)throw new C("INVALID_RESOURCE");if(!_.has(n.mimeType))throw new C("INVALID_MIME");return n}catch(e){throw new C(e&&e.code||"UNKNOWN_ERROR")}})}transformContent(t){return i.__awaiter(this,void 0,void 0,function*(){if(t.artifactUrl.indexOf("content-store")>=0&&(yield this.setS3Cookie(t.artifactUrl)),"Certification"===t.resourceType)return{content:Object.assign({},t,{mimeType:l.a.certification})};switch(t.mimeType){case l.a.mp4:const e=yield this.transformVideo(t);return{content:t,video:e};case l.a.m3u8:return yield this.setVideojsCookie(t.artifactUrl),{content:t};case l.a.quiz:const n=yield this.transformQuiz(t);return{content:t,quiz:n};case l.a.webModule:case l.a.webModuleExercise:const i=yield this.transformWebModule(t);return{content:t,webModule:i};case l.a.collectionResource:const o=yield this.transformCollectionResource(t);return{content:t,collectionResource:o};case l.a.handson:const r=yield this.transformHandsOn(t);return{content:t,handsOn:r};case l.a.classDiagram:const s=yield this.transformClassDiagram(t);return{content:t,classDiagram:s};case l.a.rdbms:const a=yield this.transformDbmsModule(t);return{content:t,rdbms:a};case l.a.interaction:const c=yield this.transformInteractions(t),d=yield this.transformVideo(t);return{content:t,interactions:c,video:d};default:return{content:t}}})}transformVideo(t){return i.__awaiter(this,void 0,void 0,function*(){const e={file:t.artifactUrl,streamingToken:null,manifest:null};if(!(t.msArtifactDetails&&t.msArtifactDetails.channelId&&t.msArtifactDetails.videoId))return e;try{const{manifest:i,streamingToken:o}=yield this.miscSvc.fetchVideoTokens(t.msArtifactDetails.channelId,t.msArtifactDetails.videoId).toPromise();return e.streamingToken=o,e.manifest=i,e}catch(n){}return e})}transformQuiz(t){return i.__awaiter(this,void 0,void 0,function*(){return yield this.http.get(t.artifactUrl).toPromise().catch(t=>{throw new C("MANIFEST_FETCH_FAILED")})})}transformHandsOn(t){return i.__awaiter(this,void 0,void 0,function*(){return yield this.http.get(t.artifactUrl).toPromise().catch(t=>{throw new C("MANIFEST_FETCH_FAILED")})})}transformClassDiagram(t){return i.__awaiter(this,void 0,void 0,function*(){return yield this.http.get(t.artifactUrl).toPromise().catch(t=>{throw new C("MANIFEST_FETCH_FAILED")})})}transformDbmsModule(t){return i.__awaiter(this,void 0,void 0,function*(){return yield this.http.get(t.artifactUrl).toPromise()})}transformWebModule(t){return i.__awaiter(this,void 0,void 0,function*(){return yield this.http.get(t.artifactUrl).toPromise().catch(t=>{throw new C("MANIFEST_FETCH_FAILED")})})}transformCollectionResource(t){return i.__awaiter(this,void 0,void 0,function*(){return yield this.http.get(t.artifactUrl).toPromise().catch(t=>{throw new C("MANIFEST_FETCH_FAILED")})})}transformInteractions(t){return i.__awaiter(this,void 0,void 0,function*(){return yield this.http.get(t.artifactUrl).toPromise().catch(t=>{throw new C("MANIFEST_FETCH_FAILED")})})}resumePoint(t){return i.__awaiter(this,void 0,void 0,function*(){try{const n=yield this.historySvc.fetchContentContinueLearning(t).toPromise();if(n&&Array.isArray(n.results)&&n.results.length>0&&n.results[0].continueLearningData)return n.results[0].continueLearningData.data}catch(e){}return null})}setVideojsCookie(t){return i.__awaiter(this,void 0,void 0,function*(){yield this.s3ContentApi.setVideoCookie(t).toPromise().catch(t=>{throw new C("COOKIE_SET_FAILURE")})})}setS3Cookie(t){return i.__awaiter(this,void 0,void 0,function*(){yield this.s3ContentApi.setS3Cookie(t).toPromise().catch(t=>{throw new C("COOKIE_SET_FAILURE")})})}initGlobalDataRequestResponder(){Object(o.a)(window,"message").pipe(Object(r.a)(t=>t&&t.data&&t.data.type===y&&Boolean(t.data.data.contentId)&&Boolean(t.source)&&"function"==typeof t.source.postMessage)).subscribe(t=>i.__awaiter(this,void 0,void 0,function*(){const e=t.source,n=t.data,i=yield this.processResponse(n.data);e.postMessage({app:"WEB_PLAYER",data:i,plugin:"NONE",state:"NONE",type:v},"*")}))}resumePointStringToProgressNumber(t){try{const n=JSON.parse(t),i=parseInt(n.progress.toString(),10);return Number.isNaN(i)||Math.round(i)!==i?0:i}catch(e){return 0}}}E.ngInjectableDef=d["\u0275\u0275defineInjectable"]({factory:function(){return new E(d["\u0275\u0275inject"](u.c),d["\u0275\u0275inject"](p.a),d["\u0275\u0275inject"](m.a),d["\u0275\u0275inject"](f.a),d["\u0275\u0275inject"](h))},token:E,providedIn:"root"})},l5mm:function(t,e,n){"use strict";n.d(e,"a",function(){return s});var i=n("HDdC"),o=n("D0XW"),r=n("Y7HM");function s(t=0,e=o.a){return(!Object(r.a)(t)||t<0)&&(t=0),e&&"function"==typeof e.schedule||(e=o.a),new i.a(n=>(n.add(e.schedule(a,t,{subscriber:n,counter:0,period:t})),n))}function a(t){const{subscriber:e,counter:n,period:i}=t;e.next(n),this.schedule({subscriber:e,counter:n+1,period:i},i)}},oVAt:function(t,e,n){"use strict";n.d(e,"a",function(){return r});var i=n("Jmk9"),o=n("8Y7J");class r{constructor(t){this.historyApiSvc=t}fetchContinueLearning(t,e,n){return this.historyApiSvc.fetchContinueLearning(t,e,n)}fetchContentContinueLearning(t){return this.historyApiSvc.fetchContentContinueLearning(t)}saveContinueLearning(t,e){return this.historyApiSvc.saveContinueLearning(t,e)}addToHistory(t){return this.historyApiSvc.addHistory(t)}}r.ngInjectableDef=o["\u0275\u0275defineInjectable"]({factory:function(){return new r(o["\u0275\u0275inject"](i.a))},token:r,providedIn:"root"})},pHa5:function(t,e,n){"use strict";n.r(e);var i=n("8Y7J");class o{}var r=n("pMnS"),s=n("mrSG"),a=n("RB3e"),c=n("FISf"),d=n("PnTj");class u{constructor(t,e,n,o){this.route=t,this.playerDataSvc=e,this.audioSvc=n,this.viewerSvc=o,this.resourceEnded=new i.EventEmitter}ngOnInit(){return s.__awaiter(this,void 0,void 0,function*(){this.paramSubscription=this.route.data.subscribe(t=>{this.processedContent=t.playerDetails.processedResource,this.collectionId=t.playerDetails.toc.identifier,this.onInItFunction()})})}ngOnDestroy(){this.disposePlayer()}onInItFunction(){return s.__awaiter(this,void 0,void 0,function*(){this.processedContent&&this.processedContent.content&&(yield this.loadPlayer())})}loadPlayer(){return s.__awaiter(this,void 0,void 0,function*(){this.disposePlayer();const t="amp_plugin_"+Date.now()+"_"+this.processedContent.content.identifier,e=this.viewerSvc.resumePointStringToProgressNumber(this.processedContent.resumeData);this.audioContainer.nativeElement.innerHTML=`<audio id="${t}" class="azuremediaplayer amp-flush-skin amp-big-play-centered"></audio>`,this.player=yield this.audioSvc.init(t,this.processedContent.content.artifactUrl,null,null,this.processedContent.content.appIcon,this.processedContent.content.identifier,this.processedContent.content.contentType,this.processedContent.content.mimeType,this.collectionId,e,[],{},{autoplay:!0,enableContinueLearning:!0}),this.player.addEventListener("ended",()=>{this.resourceEnded.emit()})})}disposePlayer(){this.player&&"function"==typeof this.player.dispose&&this.player.dispose()}}var h=n("iInd"),l=i["\u0275crt"]({encapsulation:0,styles:[[".audio-container[_ngcontent-%COMP%]{height:100%}"]],data:{}});function p(t){return i["\u0275vid"](0,[i["\u0275qud"](402653184,1,{audioContainer:0}),(t()(),i["\u0275eld"](1,0,[[1,0],["audioContainer",1]],null,0,"div",[["class","audio-container"]],null,null,null,null,null))],null,null)}function f(t){return i["\u0275vid"](0,[(t()(),i["\u0275eld"](0,0,null,null,1,"ws-audio",[],null,null,null,p,l)),i["\u0275did"](1,245760,null,0,u,[h.a,a.a,c.a,d.a],null,null)],function(t,e){t(e,1,0)},null)}var m=i["\u0275ccf"]("ws-audio",u,f,{},{resourceEnded:"resourceEnded"},[]),y=n("SVse"),v=n("zsyL");class _{}n.d(e,"AudioModuleNgFactory",function(){return C});var C=i["\u0275cmf"](o,[],function(t){return i["\u0275mod"]([i["\u0275mpd"](512,i.ComponentFactoryResolver,i["\u0275CodegenComponentFactoryResolver"],[[8,[r.a,m]],[3,i.ComponentFactoryResolver],i.NgModuleRef]),i["\u0275mpd"](4608,y.q,y.p,[i.LOCALE_ID,[2,y.L]]),i["\u0275mpd"](4608,v.a,v.a,[a.a]),i["\u0275mpd"](1073742336,y.c,y.c,[]),i["\u0275mpd"](1073742336,h.s,h.s,[[2,h.x],[2,h.o]]),i["\u0275mpd"](1073742336,_,_,[]),i["\u0275mpd"](1073742336,o,o,[]),i["\u0275mpd"](256,i.LOCALE_ID,"de",[]),i["\u0275mpd"](1024,h.m,function(){return[[{path:"",pathMatch:"full",component:u,resolve:{playerDetails:v.a}}]]},[]),i["\u0275mpd"](256,i.TRANSLATIONS_FORMAT,"xlf",[])])})}}]);