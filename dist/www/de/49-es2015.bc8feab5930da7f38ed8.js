/*               "Copyright 2020 Infosys Ltd.
               Use of this source code is governed by GPL v3 license that can be found in the LICENSE file or at https://opensource.org/licenses/GPL-3.0
               This program is free software: you can redistribute it and/or modify it under the terms of the GNU General Public License version 3"*/
(window.webpackJsonp=window.webpackJsonp||[]).push([[49],{Jmk9:function(t,e,i){"use strict";i.d(e,"a",function(){return a});var r=i("z6cu"),n=i("VX4o"),s=i("8Y7J"),o=i("IheW");class a{constructor(t,e){this.http=t,this.telemetrySvc=e,this.API_BASE="/clientApi/v2",this.USER_API=`${this.API_BASE}/user`,this.apiEndpoints={USER_HISTORY:`${this.USER_API}/history`,USER_CONTINUE_LEARNING:`${this.USER_API}/history/continue`}}fetchContinueLearning(t,e,i){return this.http.get(`${this.apiEndpoints.USER_CONTINUE_LEARNING}?pageSize=${t}`+(e?`&pageState=${e}`:"")+(i?`&email=${i}`:""))}saveContinueLearning(t,e){const i=this.apiEndpoints.USER_CONTINUE_LEARNING;return Object.keys(t).length?this.http.post(i,t):(this.telemetrySvc.errorTelemetryEvent(i,t,e),Object(r.a)({message:"EMPTY_REQUEST"}))}fetchContentContinueLearning(t){return this.http.get(`${this.apiEndpoints.USER_CONTINUE_LEARNING}/${t}`)}addHistory(t){return this.http.post(this.apiEndpoints.USER_HISTORY+"/"+t,{})}deleteHistory(t){return this.http.delete(this.apiEndpoints.USER_HISTORY+"/"+t)}}a.ngInjectableDef=s["\u0275\u0275defineInjectable"]({factory:function(){return new a(s["\u0275\u0275inject"](o.c),s["\u0275\u0275inject"](n.a))},token:a,providedIn:"root"})},PnTj:function(t,e,i){"use strict";var r=i("mrSG"),n=i("xgIS"),s=i("pLZG"),o=i("5DKC"),a=i("LRne"),c=i("JIr8"),u=i("8Y7J"),h=i("IheW");class d{constructor(t){this.http=t,this.apiEndpoints={setCookie:`${o.c}/videojs/setCookie`,setS3Cookie:`${o.d}/setS3Cookie/setCookie`}}setVideoCookie(t){return this.http.post(this.apiEndpoints.setCookie,{path:t}).pipe(Object(c.a)(t=>Object(a.a)(!0)))}setS3Cookie(t){return this.http.post(this.apiEndpoints.setS3Cookie,{path:t}).pipe(Object(c.a)(t=>Object(a.a)(!0)))}}d.ngInjectableDef=u["\u0275\u0275defineInjectable"]({factory:function(){return new d(u["\u0275\u0275inject"](h.c))},token:d,providedIn:"root"});var l=i("hFHK"),p=i("NBun"),m=i("oVAt"),f=i("vPp1");i.d(e,"a",function(){return S});const g="DATA_REQUEST",y="DATA_RESPONSE",C=new Set(Object.values(l.a));class v extends Error{constructor(t){super(t),this.code=t}}class S{constructor(t,e,i,r,n){this.http=t,this.contentSvc=e,this.miscSvc=i,this.historySvc=r,this.s3ContentApi=n,this.initGlobalDataRequestResponder()}updateViewCountAndHistoryOnLoad(t,e){this.contentSvc.updateViewCount(e).toPromise(),t&&t!==e&&this.historySvc.saveContinueLearning({contextPathId:t,resourceId:e,percentComplete:0,data:JSON.stringify({timestamp:Date.now()})},e).toPromise().catch(t=>console.warn(t)),this.historySvc.addToHistory(e)}processResponse(t){return r.__awaiter(this,void 0,void 0,function*(){const e={id:t.id,data:null},i=this.resumePoint(t.contentId);try{const n=yield this.fetchContentAndValidate(t.contentId);e.data=yield this.transformContent(n),e.data.resumeData=yield i}catch(r){e.error=r.code||"UNKNOWN_ERROR"}return e})}fetchContentAndValidate(t){return r.__awaiter(this,void 0,void 0,function*(){try{const i=yield this.contentSvc.fetchContent(t).toPromise();if("Resource"!==i.contentType&&"Knowledge Artifact"!==i.contentType)throw new v("INVALID_RESOURCE");if(!C.has(i.mimeType))throw new v("INVALID_MIME");return i}catch(e){throw new v(e&&e.code||"UNKNOWN_ERROR")}})}transformContent(t){return r.__awaiter(this,void 0,void 0,function*(){if(t.artifactUrl.indexOf("content-store")>=0&&(yield this.setS3Cookie(t.artifactUrl)),"Certification"===t.resourceType)return{content:Object.assign({},t,{mimeType:l.a.certification})};switch(t.mimeType){case l.a.mp4:const e=yield this.transformVideo(t);return{content:t,video:e};case l.a.m3u8:return yield this.setVideojsCookie(t.artifactUrl),{content:t};case l.a.quiz:const i=yield this.transformQuiz(t);return{content:t,quiz:i};case l.a.webModule:case l.a.webModuleExercise:const r=yield this.transformWebModule(t);return{content:t,webModule:r};case l.a.collectionResource:const n=yield this.transformCollectionResource(t);return{content:t,collectionResource:n};case l.a.handson:const s=yield this.transformHandsOn(t);return{content:t,handsOn:s};case l.a.classDiagram:const o=yield this.transformClassDiagram(t);return{content:t,classDiagram:o};case l.a.rdbms:const a=yield this.transformDbmsModule(t);return{content:t,rdbms:a};case l.a.interaction:const c=yield this.transformInteractions(t),u=yield this.transformVideo(t);return{content:t,interactions:c,video:u};default:return{content:t}}})}transformVideo(t){return r.__awaiter(this,void 0,void 0,function*(){const e={file:t.artifactUrl,streamingToken:null,manifest:null};if(!(t.msArtifactDetails&&t.msArtifactDetails.channelId&&t.msArtifactDetails.videoId))return e;try{const{manifest:r,streamingToken:n}=yield this.miscSvc.fetchVideoTokens(t.msArtifactDetails.channelId,t.msArtifactDetails.videoId).toPromise();return e.streamingToken=n,e.manifest=r,e}catch(i){}return e})}transformQuiz(t){return r.__awaiter(this,void 0,void 0,function*(){return yield this.http.get(t.artifactUrl).toPromise().catch(t=>{throw new v("MANIFEST_FETCH_FAILED")})})}transformHandsOn(t){return r.__awaiter(this,void 0,void 0,function*(){return yield this.http.get(t.artifactUrl).toPromise().catch(t=>{throw new v("MANIFEST_FETCH_FAILED")})})}transformClassDiagram(t){return r.__awaiter(this,void 0,void 0,function*(){return yield this.http.get(t.artifactUrl).toPromise().catch(t=>{throw new v("MANIFEST_FETCH_FAILED")})})}transformDbmsModule(t){return r.__awaiter(this,void 0,void 0,function*(){return yield this.http.get(t.artifactUrl).toPromise()})}transformWebModule(t){return r.__awaiter(this,void 0,void 0,function*(){return yield this.http.get(t.artifactUrl).toPromise().catch(t=>{throw new v("MANIFEST_FETCH_FAILED")})})}transformCollectionResource(t){return r.__awaiter(this,void 0,void 0,function*(){return yield this.http.get(t.artifactUrl).toPromise().catch(t=>{throw new v("MANIFEST_FETCH_FAILED")})})}transformInteractions(t){return r.__awaiter(this,void 0,void 0,function*(){return yield this.http.get(t.artifactUrl).toPromise().catch(t=>{throw new v("MANIFEST_FETCH_FAILED")})})}resumePoint(t){return r.__awaiter(this,void 0,void 0,function*(){try{const i=yield this.historySvc.fetchContentContinueLearning(t).toPromise();if(i&&Array.isArray(i.results)&&i.results.length>0&&i.results[0].continueLearningData)return i.results[0].continueLearningData.data}catch(e){}return null})}setVideojsCookie(t){return r.__awaiter(this,void 0,void 0,function*(){yield this.s3ContentApi.setVideoCookie(t).toPromise().catch(t=>{throw new v("COOKIE_SET_FAILURE")})})}setS3Cookie(t){return r.__awaiter(this,void 0,void 0,function*(){yield this.s3ContentApi.setS3Cookie(t).toPromise().catch(t=>{throw new v("COOKIE_SET_FAILURE")})})}initGlobalDataRequestResponder(){Object(n.a)(window,"message").pipe(Object(s.a)(t=>t&&t.data&&t.data.type===g&&Boolean(t.data.data.contentId)&&Boolean(t.source)&&"function"==typeof t.source.postMessage)).subscribe(t=>r.__awaiter(this,void 0,void 0,function*(){const e=t.source,i=t.data,r=yield this.processResponse(i.data);e.postMessage({app:"WEB_PLAYER",data:r,plugin:"NONE",state:"NONE",type:y},"*")}))}resumePointStringToProgressNumber(t){try{const i=JSON.parse(t),r=parseInt(i.progress.toString(),10);return Number.isNaN(r)||Math.round(r)!==r?0:r}catch(e){return 0}}}S.ngInjectableDef=u["\u0275\u0275defineInjectable"]({factory:function(){return new S(u["\u0275\u0275inject"](h.c),u["\u0275\u0275inject"](p.a),u["\u0275\u0275inject"](f.a),u["\u0275\u0275inject"](m.a),u["\u0275\u0275inject"](d))},token:S,providedIn:"root"})},"U+en":function(t,e,i){"use strict";i.r(e);var r=i("8Y7J");class n{}var s=i("pMnS"),o=i("xgIS"),a=i("pLZG"),c=i("lJxs"),u=i("hFHK"),h=i("qfBg"),d=i("r4Kj"),l=i("oVAt"),p=i("PnTj");const m="TELEMETRY",f="/public-assets/common/plugins/pdf/web/viewer.html";class g{constructor(t,e,i,r,n,s,o){this.route=t,this.router=e,this.domSanitizer=i,this.viewerSvc=r,this.historySvc=n,this.userSvc=s,this.configSvc=o,this.maxLastPageNumber=0,this.realTimeProgressRequest={content_type:"Resource",current:[],max_size:0,mime_type:u.a.pdf,user_id_type:"uuid"},this.hasFiredRealTimeProgress=!1}ngOnInit(){this.paramSubscription=this.route.data.subscribe(t=>{this.processedContent=t.playerDetails.processedResource,this.collectionId=t.playerDetails.toc.identifier,this.iframeUrlSet()})}ngOnChanges(){if(this.processedContent&&this.processedContent.content){this.pageChangeHandler(),this.iframeUrl=null,this.maxLastPageNumber=0;const t=this.getUrl();t&&(this.iframeUrl=this.domSanitizer.bypassSecurityTrustResourceUrl(t))}}iframeUrlSet(){if(this.processedContent&&this.processedContent.content){this.pageChangeHandler(),this.iframeUrl=null,this.maxLastPageNumber=0;const t=this.getUrl();t&&(this.iframeUrl=this.domSanitizer.bypassSecurityTrustResourceUrl(t))}}pageChangeHandler(){this.pageChangeSubscription=Object(o.a)(window,"message").pipe(Object(a.a)(t=>t&&t.data&&t.data.type===m),Object(c.a)(t=>t.data),Object(a.a)(t=>"SLIDE_CHANGE"===t.state||"LOADED"===t.state),Object(c.a)(t=>t.data)).subscribe(t=>{t.pageNumber&&t.pageNumber>this.maxLastPageNumber&&(this.maxLastPageNumber=t.pageNumber),this.configSvc.instanceConfig.platform.updateRealTimeProgress&&this.raiseRealTimeProgress(t),this.historySvc.saveContinueLearning({contextPathId:this.processedContent.content.identifier,resourceId:this.processedContent.content.identifier,percentComplete:t.total&&t.total>0?Math.round(100*this.maxLastPageNumber/t.total):100,data:JSON.stringify({progress:t.pageNumber||this.maxLastPageNumber,timestamp:Date.now()})},this.processedContent.content.identifier).toPromise().catch(t=>console.warn(t))})}raiseRealTimeProgress(t){const e=[...this.realTimeProgressRequest.current];this.realTimeProgressRequest=Object.assign({},this.realTimeProgressRequest,{current:Array.from(new Set([...this.realTimeProgressRequest.current,t.pageNumber.toString()])),max_size:t.total}),e.length===this.realTimeProgressRequest.current.length&&this.realTimeProgressRequest.current.every((t,i)=>t===e[i])||(this.realTimeProgressTimer&&clearTimeout(this.realTimeProgressTimer),this.hasFiredRealTimeProgress=!1,this.realTimeProgressTimer=setTimeout(()=>{this.hasFiredRealTimeProgress=!0,this._fireRealTimeProgress()},12e4))}_fireRealTimeProgress(){this.realTimeProgressRequest.current.length&&(this.realTimeProgressRequest.content_type=this.processedContent.content.contentType,this.userSvc.realTimeProgressUpdate(this.processedContent.content.identifier,this.realTimeProgressRequest).subscribe())}getUrl(){let t;const e=this.viewerSvc.resumePointStringToProgressNumber(this.processedContent.resumeData);return this.processedContent&&this.processedContent.content&&this.processedContent.content.artifactUrl&&(t=this.processedContent.content.artifactUrl),t?`${f}?file=${encodeURIComponent(t)}&contentId=${this.processedContent.content.identifier}`+(this.collectionId?`&courseId=${this.collectionId}`:"")+(e?`&startFrom=${e}`:""):null}ngOnDestroy(){!this.hasFiredRealTimeProgress&&this.configSvc.instanceConfig.platform.updateRealTimeProgress&&(this._fireRealTimeProgress(),this.realTimeProgressTimer&&clearTimeout(this.realTimeProgressTimer)),this.pageChangeSubscription&&this.pageChangeSubscription.unsubscribe()}}var y=i("iInd"),C=i("cUpR"),v=r["\u0275crt"]({encapsulation:0,styles:[[".pdf-iframe[_ngcontent-%COMP%]{display:block;width:100%;height:100%;border:0}"]],data:{}});function S(t){return r["\u0275vid"](0,[(t()(),r["\u0275eld"](0,0,null,null,0,"iframe",[["allow","fullscreen; accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture"],["class","pdf-iframe"],["frameborder","0"],["title","PDF-Betrachter"]],[[8,"src",5]],null,null,null,null))],null,function(t,e){t(e,0,0,e.component.iframeUrl)})}function T(t){return r["\u0275vid"](0,[(t()(),r["\u0275eld"](0,0,null,null,1,"ws-pdf",[],null,null,null,S,v)),r["\u0275did"](1,770048,null,0,g,[y.a,y.o,C.b,p.a,l.a,h.a,d.a],null,null)],function(t,e){t(e,1,0)},null)}var _=r["\u0275ccf"]("ws-pdf",g,T,{},{},[]),E=i("SVse"),I=i("zsyL"),R=i("RB3e");class b{}i.d(e,"PdfModuleNgFactory",function(){return w});var w=r["\u0275cmf"](n,[],function(t){return r["\u0275mod"]([r["\u0275mpd"](512,r.ComponentFactoryResolver,r["\u0275CodegenComponentFactoryResolver"],[[8,[s.a,_]],[3,r.ComponentFactoryResolver],r.NgModuleRef]),r["\u0275mpd"](4608,E.q,E.p,[r.LOCALE_ID,[2,E.L]]),r["\u0275mpd"](4608,I.a,I.a,[R.a]),r["\u0275mpd"](1073742336,E.c,E.c,[]),r["\u0275mpd"](1073742336,y.s,y.s,[[2,y.x],[2,y.o]]),r["\u0275mpd"](1073742336,b,b,[]),r["\u0275mpd"](1073742336,n,n,[]),r["\u0275mpd"](256,r.LOCALE_ID,"de",[]),r["\u0275mpd"](1024,y.m,function(){return[[{path:"",pathMatch:"full",component:g,resolve:{playerDetails:I.a}}]]},[]),r["\u0275mpd"](256,r.TRANSLATIONS_FORMAT,"xlf",[])])})},oVAt:function(t,e,i){"use strict";i.d(e,"a",function(){return s});var r=i("Jmk9"),n=i("8Y7J");class s{constructor(t){this.historyApiSvc=t}fetchContinueLearning(t,e,i){return this.historyApiSvc.fetchContinueLearning(t,e,i)}fetchContentContinueLearning(t){return this.historyApiSvc.fetchContentContinueLearning(t)}saveContinueLearning(t,e){return this.historyApiSvc.saveContinueLearning(t,e)}addToHistory(t){return this.historyApiSvc.addHistory(t)}}s.ngInjectableDef=n["\u0275\u0275defineInjectable"]({factory:function(){return new s(n["\u0275\u0275inject"](r.a))},token:s,providedIn:"root"})}}]);